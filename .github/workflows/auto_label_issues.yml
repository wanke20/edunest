name: Auto Label Issues
on:
  issues:
    types:
      - opened

jobs:
  auto-label-issues:
    runs-on: ubuntu-latest

    steps:
      - name: Check out the code
        uses: actions/checkout@v3

      - name: Setup Node.js 18
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Auto Label Issues
        run: |
          node - <<EOF
          const { Octokit } = require('octokit');

          const octokit = new Octokit({
            auth: process.env.GITHUB_TOKEN,
          });

          async function labelIssues() {
            const issues = await octokit.rest.issues.listForRepo({
              owner: '$GITHUB_REPOSITORY_OWNER',
              repo: '$GITHUB_REPOSITORY',
              state: 'open',
            });

            for (const issue of issues.data) {
              // Labeling logic based on keywords
              const keywords = ['bug', 'feature', 'enhancement'];

              for (const keyword of keywords) {
                if (issue.title.toLowerCase().includes(keyword)) {
                  await octokit.rest.issues.addLabels({
                    owner: '$GITHUB_REPOSITORY_OWNER',
                    repo: '$GITHUB_REPOSITORY',
                    issue_number: issue.number,
                    labels: [keyword],
                  });
                }
              }
            }
          }

          labelIssues().catch((error) => {
            console.error(error);
            process.exit(1);
          });
          EOF
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_REPOSITORY_OWNER: ${{ github.repository_owner }}
          GITHUB_REPOSITORY: ${{ github.repository }}
